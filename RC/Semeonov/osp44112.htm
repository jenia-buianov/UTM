<HTML><HEAD>
<!-- Meta http equivalent was here                                     -->
<META NAME="keywords" CONTENT="OSPF
алгоритм Дикстры



">
<TITLE>4.4.11.2 Протокол OSPF (алгоритм Дикстры)</TITLE>
</HEAD>
<BODY background="gainsboro" tppabs="http://book.itep.ru/gainsboro" link="#0000FF">

<center>
<table BORDER="0" CELLSPACING="1" CELLPADDING="5" bgcolor="ghostwhite">
  <tr>
    <td VALIGN="TOP" bgcolor="steelblue" LINK="#0000FF"><p align="center">

<A HREF="rip44111.htm" tppabs="http://book.itep.ru/4/44/rip44111.htm">  <IMG ALIGN=BOTTOM ALT="previous" SRC="k_prev.jpg" tppabs="http://book.itep.ru/k_prev.jpg"></A>


<A HREF="rut_4411.htm" tppabs="http://book.itep.ru/4/44/rut_4411.htm">   <IMG ALIGN=BOTTOM ALT="up"   SRC="k_up.jpg" tppabs="http://book.itep.ru/k_up.jpg"></A>


<A HREF="proc_45.htm" tppabs="http://book.itep.ru/4/45/proc_45.htm"><IMG ALIGN=BOTTOM ALT="down" SRC="k_down.jpg" tppabs="http://book.itep.ru/k_down.jpg"></A>


<A HREF="igp44113.htm" tppabs="http://book.itep.ru/4/44/igp44113.htm"><IMG ALIGN=BOTTOM ALT="next" SRC="k_next.jpg" tppabs="http://book.itep.ru/k_next.jpg"></A>

<A HREF="intro1.htm" tppabs="http://book.itep.ru/1/intro1.htm">  <IMG ALIGN=BOTTOM ALT="index" SRC="k_indx.jpg" tppabs="http://book.itep.ru/k_indx.jpg"></A>
<BR>

<B> <FONT COLOR="white">Previous: </FONT></B>
<A HREF="rip44111.htm" tppabs="http://book.itep.ru/4/44/rip44111.htm"><FONT COLOR="lightblue">4.4.11.1 Внутренний    протокол маршрутизации RIP</FONT></A>


<B><FONT COLOR="white">&nbsp;&nbsp; UP:</FONT> </B>
<A HREF="rut_4411.htm" tppabs="http://book.itep.ru/4/44/rut_4411.htm"><FONT COLOR="lightblue">4.4.11 Протоколы    маршрутизации (обзор, таблицы маршрутизации, вектор расстояния)</FONT></A>
<BR>


<B><FONT COLOR="white"> Down:</FONT></B>
<A HREF="proc_45.htm" tppabs="http://book.itep.ru/4/45/proc_45.htm"><FONT COLOR="lightblue">4.5 Процедуры Интернет</FONT></A><BR>


<B><FONT COLOR="white">&nbsp; &nbsp; Next:</FONT></B>
<A HREF="igp44113.htm" tppabs="http://book.itep.ru/4/44/igp44113.htm"><FONT COLOR="lightblue">4.4.11.3 Протокол IGRP</FONT></A>

</TD></TR>
<TR><TD ALIGN=CENTER>   
<FONT color="#0000FF" size=6><B>4.4.11.2 Протокол OSPF (алгоритм Дикстры)</B></FONT><br>
<FONT size=3>Семенов Ю.А. (ГНЦ ИТЭФ)</FONT></p>

</TD></TR>
<TR><TD>
<!--new-->
<p ALIGN="justify">Протокол OSPF (Open Shortest Pass First, RFC-1245-48, RFC-1583-1587, алгоритмы предложены Дикстрой) является альтернативой RIP в качестве внутреннего протокола маршрутизации. OSPF представляет собой протокол состояния маршрута (в качестве метрики используется - коэффициент качества обслуживания). Каждый маршрутизатор обладает полной информацией о состоянии всех интерфейсов всех маршрутизаторов (переключателей) автономной системы. Протокол OSPF реализован в демоне маршрутизации gated, который поддерживает также RIP и внешний протокол маршрутизации BGP.</P>

<p ALIGN="justify">Автономная система может быть разделена на несколько областей, куда могут входить как отдельные ЭВМ, так и целые сети. В этом случае внутренние маршрутизаторы области могут и не иметь информации о топологии остальной части AS. Сеть обычно имеет выделенный (designated) маршрутизатор, который является источником маршрутной информации для остальных
маршрутизаторов AS. Каждый маршрутизатор самостоятельно решает задачу оптимизации маршрутов. Если к месту назначения ведут два или более эквивалентных маршрута, информационный поток будет поделен между ними поровну. Переходные процессы в OSPF завершаются быстрее, чем в RIP. В процессе выбора оптимального маршрута анализируется ориентированный граф сети. Ниже
описан алгоритм Дикстры по выбору оптимального пути. На иллюстративном рис. 4.2.11.2.1 приведена схема узлов (A-J) со значениями метрики для каждого из отрезков пути. Анализ графа начинается с узла <b>A</b> (Старт). Пути с наименьшим суммарным значением метрики считаются наилучшими. Именно
они оказываются выбранными в результате рассмотрения графа (“кратчайшие пути“).</p>

<p align="center"><img src="image518.gif" tppabs="http://book.itep.ru/4/44/image518.gif"></p>
<p align="center">Рис. 4.2.11.2.1 Иллюстрация работы алгоритма Дикстры</p>

<p align="justify">Ниже дается формальное описание алгоритма. Сначала вводим некоторые определения.</p>

<p>Пусть <b>D(v)</b> равно сумме весов связей для данного пути.<br>
Пусть <b>c(i,j)</b> равно весу связи между узлами с номерами <b>i</b> и <b>j</b>.</p>

<p>Далее следует последовательность шагов, реализующих алгоритм.

<ol>
  <li>Устанавливаем множество узлов <b>N = {1}.</b></li>  
  <li>Для каждого узла <b>v</b> не из множества <b>n</b> устанавливаем <b>D(v)= c(1,v).</b></li>
  <li>Для каждого шага находим узел <b>w</b> не из множества <b>N</b>, для которого <b>D(w)</b> минимально, и добавляем узел <b>w</b> в множество <b>N</b>.</li>
  <li>Актуализируем <b>D(v)</b> для всех узлов не из множества <b>N</b> <br>
    <b>D(v)=min{D(v),</b> <b>D(v)+c(w,v)}</b>.</li>
  <li>Повторяем шаги 2-4, пока все узлы не окажутся в множестве <b>N</b>.</li>
</ol>

<p align="justify">Топология маршрутов для узла a приведена на нижней части рис. 4.2.11.2.1. В скобках записаны числа, характеризующие метрику
отобранного маршрута согласно критерию пункта 3.</p>

<p align="center">Таблица 4.2.11.2.1. Реализация алгоритма</p>
<div align="center">

<table cellspacing="0" border="10" cellpadding="4" width="700" bgcolor="ghostwhite">
  <tr>
    <td width="9%" valign="top" bgcolor="gainsboro"></td>
    <td width="29%" valign="top" bgcolor="gainsboro" align="center"><b>Множество</b></td>
    <td width="62%" valign="top" colspan="9" bgcolor="gainsboro">Метрика связи узла <b>a</b> с узлами</td>
  </tr>
  <tr>
    <td width="9%" valign="top"><p align="center"><b>Шаг</b></td>
    <td width="29%" valign="top"><b><p align="center">N</b></td>
    <td width="8%" valign="top"><b>B</b></td>
    <td width="6%" valign="top"><b>C</b></td>
    <td width="8%" valign="top"><b>D</b></td>
    <td width="6%" valign="top"><b>E</b></td>
    <td width="8%" valign="top"><b>F</b></td>
    <td width="8%" valign="top"><b>G</b></td>
    <td width="6%" valign="top"><b>H</b></td>
    <td width="6%" valign="top"><b>I</b></td>
    <td width="7%" valign="top"><b>J</b></td>
  </tr>
  <tr>
    <td width="9%" valign="top"><p align="center">0</td>
    <td width="29%" valign="top"><p align="center">{A}</td>
    <td width="8%" valign="top">3</td>
    <td width="6%" valign="top">-</td>
    <td width="8%" valign="top">9</td>
    <td width="6%" valign="top">-</td>
    <td width="8%" valign="top">-</td>
    <td width="8%" valign="top">-</td>
    <td width="6%" valign="top">-</td>
    <td width="6%" valign="top">-</td>
    <td width="7%" valign="top">-</td>
  </tr>
  <tr>
    <td width="9%" valign="top"><p align="center">1</td>
    <td width="29%" valign="top"><p align="center">{A,B}</td>
    <td width="8%" valign="top">(3)</td>
    <td width="6%" valign="top">4</td>
    <td width="8%" valign="top">9</td>
    <td width="6%" valign="top">7</td>
    <td width="8%" valign="top">-</td>
    <td width="8%" valign="top">10</td>
    <td width="6%" valign="top">-</td>
    <td width="6%" valign="top">-</td>
    <td width="7%" valign="top">-</td>
  </tr>
  <tr>
    <td width="9%" valign="top"><p align="center">2</td>
    <td width="29%" valign="top"><p align="center">{A,B,C}</td>
    <td width="8%" valign="top">3</td>
    <td width="6%" valign="top">(4)</td>
    <td width="8%" valign="top">6</td>
    <td width="6%" valign="top">6</td>
    <td width="8%" valign="top">10</td>
    <td width="8%" valign="top">10</td>
    <td width="6%" valign="top">8</td>
    <td width="6%" valign="top">-</td>
    <td width="7%" valign="top">14</td>
  </tr>
  <tr>
    <td width="9%" valign="top"><p align="center">3</td>
    <td width="29%" valign="top"><p align="center">{A,BC,D}</td>
    <td width="8%" valign="top">3</td>
    <td width="6%" valign="top">4</td>
    <td width="8%" valign="top">(6)</td>
    <td width="6%" valign="top">6</td>
    <td width="8%" valign="top">10</td>
    <td width="8%" valign="top">10</td>
    <td width="6%" valign="top">8</td>
    <td width="6%" valign="top">9</td>
    <td width="7%" valign="top">14</td>
  </tr>
  <tr>
    <td width="9%" valign="top"><p align="center">4</td>
    <td width="29%" valign="top"><p align="center">{A,B,C,D,E}</td>
    <td width="8%" valign="top">3</td>
    <td width="6%" valign="top">4</td>
    <td width="8%" valign="top">6</td>
    <td width="6%" valign="top">(6)</td>
    <td width="8%" valign="top">10</td>
    <td width="8%" valign="top">10</td>
    <td width="6%" valign="top">8</td>
    <td width="6%" valign="top">9</td>
    <td width="7%" valign="top">14</td>
  </tr>
  <tr>
    <td width="9%" valign="top"><p align="center">5</td>
    <td width="29%" valign="top"><p align="center">{A,B,C,D,E,H}</td>
    <td width="8%" valign="top">3</td>
    <td width="6%" valign="top">4</td>
    <td width="8%" valign="top">6</td>
    <td width="6%" valign="top">6</td>
    <td width="8%" valign="top">10</td>
    <td width="8%" valign="top">10</td>
    <td width="6%" valign="top">(8)</td>
    <td width="6%" valign="top">9</td>
    <td width="7%" valign="top">14</td>
  </tr>
  <tr>
    <td width="9%" valign="top"><p align="center">6</td>
    <td width="29%" valign="top"><p align="center">{A,B,C,D,E,H,I}</td>
    <td width="8%" valign="top">3</td>
    <td width="6%" valign="top">4</td>
    <td width="8%" valign="top">6</td>
    <td width="6%" valign="top">6</td>
    <td width="8%" valign="top">10</td>
    <td width="8%" valign="top">10</td>
    <td width="6%" valign="top">8</td>
    <td width="6%" valign="top">(9)</td>
    <td width="7%" valign="top">14</td>
  </tr>
  <tr>
    <td width="9%" valign="top"><p align="center">7</td>
    <td width="29%" valign="top"><p align="center">{A,B,C,D,E,H,I,F}</td>
    <td width="8%" valign="top">3</td>
    <td width="6%" valign="top">4</td>
    <td width="8%" valign="top">6</td>
    <td width="6%" valign="top">6</td>
    <td width="8%" valign="top">(10)</td>
    <td width="8%" valign="top">10</td>
    <td width="6%" valign="top">8</td>
    <td width="6%" valign="top">9</td>
    <td width="7%" valign="top">14</td>
  </tr>
  <tr>
    <td width="9%" valign="top"><p align="center">8</td>
    <td width="29%" valign="top"><p align="center">{A,B,C,D,E,H,I,F,G}</td>
    <td width="8%" valign="top">3</td>
    <td width="6%" valign="top">4</td>
    <td width="8%" valign="top">6</td>
    <td width="6%" valign="top">6</td>
    <td width="8%" valign="top">10</td>
    <td width="8%" valign="top">(10)</td>
    <td width="6%" valign="top">8</td>
    <td width="6%" valign="top">9</td>
    <td width="7%" valign="top">14</td>
  </tr>
  <tr>
    <td width="9%" valign="top"><p align="center">9</td>
    <td width="29%" valign="top"><p align="center">{A,B,C,D,E,H,I,F,G,J}</td>
    <td width="8%" valign="top">3</td>
    <td width="6%" valign="top">4</td>
    <td width="8%" valign="top">6</td>
    <td width="6%" valign="top">6</td>
    <td width="8%" valign="top">10</td>
    <td width="8%" valign="top">10</td>
    <td width="6%" valign="top">8</td>
    <td width="6%" valign="top">9</td>
    <td width="7%" valign="top">(14)</td>
  </tr>
</table>
</div>

<p align="justify">Таблица 4.2.11.2.1 может иметь совершенно иное содержимое для какого-то другого вида сервиса, выбранные пути при этом могут иметь другую топологию. Качество сервиса (QoS) может характеризоваться следующими параметрами:</p>

<ul>
  <li>пропускной способностью канала;</li>
  <li>задержкой (время распространения пакета);</li>
  <li>числом дейтограмм, стоящих в очереди для передачи;</li>
  <li>загрузкой канала;</li>
  <li>требованиями безопасности;</li>
  <li>типом трафика;</li>
  <li>числом шагов до цели;</li>
  <li>возможностями промежуточных связей (например, многовариантность достижения адресата).</li>
</ul>

<p align="justify">Определяющими являются три характеристики: задержка, пропускная способность и надежность. Для транспортных целей OSPF использует IP непосредственно, т.е. не привлекает протоколы UDP или TCP. OSPF имеет свой код (89) в протокольном поле IP-заголовка. Код TOS (type of service) в 
IP-пакетах, содержащих OSPF-сообщения, равен нулю, значение TOS здесь задается в самих пакетах OSPF. Маршрутизация в этом протоколе определяется IP-адресом и типом сервиса. Так как протокол не требует инкапсуляции пакетов, сильно облегчается управление сетями с большим количеством бриджей и сложной 
топологией (исключается циркуляция пакетов, сокращается транзитный трафик). Автономная система может быть поделена на отдельные области, каждая из которых становится объектом маршрутизации, а внутренняя структура снаружи не
видна (узлы на рис. 4.2.11.2.1 могут представлять собой как отдельные ЭВМ или маршрутизаторы, так и целые сети). Этот прием позволяет значительно
сократить необходимый объем маршрутной базы данных. В OSPF используется термин опорной сети (backbone) для коммуникаций между выделенными областями. Протокол работает лишь в пределах автономной системы. В пределах выделенной
области может работать свой протокол маршрутизации.</p>

<p align="center"><img src="image519.gif" tppabs="http://book.itep.ru/4/44/image519.gif"></p>

<p align="center">Рис. 4.2.11.2.2 Пример выделения областей
при ospf маршрутизации в автономной системе (М – маршрутизаторы; c – сети).</p>

<p align="justify">На рис 4.2.11.2.2 (см. также рис. 4.2.11.2.1)
приведен пример выделения областей маршрутизации при ospf-маршрутизации в пределах автономной системы. На рис. 4.2.11.2.2 маршрутизаторы М4 и М2
выполняют функция опорной сети для других областей. В выделенных областях может быть любое число маршрутизаторов. Более толстыми линиями выделены связи с другими автономными системами.</p>

<p align="justify">При передаче OSPF-пакетов фрагментация не желательна, но не запрещается. Для передачи статусной информации OSPF использует
широковещательные сообщения Hello. Для повышения безопасности предусмотрена авторизация процедур. OSPF-протокол требует резервирования двух мультикастинг-адресов:</p>

<table cellspacing="0" border="0" cellpadding="2" width="800">
  <tr>
    <td width="13%" valign="top">224.0.0.5</td>
    <td width="87%" valign="top">предназначен для обращения ко всем маршрутизаторам,
    поддерживающим этот протокол.</td>
  </tr>
  <tr>
    <td width="13%" valign="top">224.0.0.6</td>
    <td width="87%" valign="top">служит для обращения к специально выделенному
    маршрутизатору.</td>
  </tr>
</table>

<p align="justify">Любое сообщение ospf начинается с 24-октетного заголовка:</p>

<p align="center"><img src="image520.gif" tppabs="http://book.itep.ru/4/44/image520.gif"></p>
<p align="center">Рис. 4.2.11.2.3 Формат заголовка сообщений для протокола маршрутизации ospf</p>

<p align="justify">Поле <i>версия</i> определяет версию протокола (= 2). Поле <i>тип</i> идентифицирует функцию сообщения согласно таблице 4.2.11.2.2:</p>

<p align="center">Таблица 4.2.11.2.2. Коды поля <i>тип</i> </p>
<div align="center"><center>

<table border="10" cellspacing="1" cellpadding="5" width="700" bgcolor="ghostwhite">
  <tr>
    <td width="10%" valign="top" bgcolor="gainsboro"><b><p align="center">Тип</b></td>
    <td width="90%" valign="top" bgcolor="gainsboro"><b><p align="justify">Значение</b></td>
  </tr>
  <tr>
    <td width="10%" valign="top"><p align="center">1</td>
    <td width="90%" valign="top"><p align="justify">Hello
    (используется для проверки доступности маршрутизатора).</td>
  </tr>
  <tr>
    <td width="10%" valign="top"><p align="center">2</td>
    <td width="90%" valign="top"><p align="justify">Описание базы данных (топология).</td>
  </tr>
  <tr>
    <td width="10%" valign="top"><p align="center">3</td>
    <td width="90%" valign="top"><p align="justify">Запрос состояния канала.</td>
  </tr>
  <tr>
    <td width="10%" valign="top"><p align="center">4</td>
    <td width="90%" valign="top"><p align="justify">Изменение состояния канала.</td>
  </tr>
  <tr>
    <td width="10%" valign="top"><p align="center">5</td>
    <td width="90%" valign="top"><p align="justify">Подтверждение получения сообщения о статусе канала.</td>
  </tr>
</table>
</center></div>

<p align="justify">Поле <i>длина пакета</i> определяет длину блока в октетах, включая заголовок. <i>Идентификатор области</i> - 32-битный код, идентифицирующий область, которой данный пакет принадлежит. Все ospf-пакеты ассоциируются с той или иной областью. Большинство из них не преодолевает более одного шага. Пакеты, путешествующие по виртуальным каналам, помечаются 
идентификатором опорной области (backbone) 0.0.0.0. Поле <i>контрольная сумма</i> содержит контрольную сумму IP-пакета, включая поле <i>типа идентификации</i>. Контрольное суммирование производится по модулю 1. Поле <i>тип идентификации</i> может принимать значения 0 при отсутствии контроля доступа, и 1 при наличии контроля. В дальнейшем функции поля будут
расширены. Важную функцию в OSPF-сообщениях выполняет одно-октетное поле <i>опции</i>, оно присутствует в сообщениях типа Hello, объявление состояния канала и описание базы данных. Особую роль в этом поле играют младшие биты e и Т:</p>

<p align="center"><img src="image521.gif" tppabs="http://book.itep.ru/4/44/image521.gif"></p>

<p align="justify">Бит E характеризует возможность внешней маршрутизации и имеет значение только в сообщениях типа Hello, в остальных сообщениях этот бит должен быть обнулен. Если E=0, то данный маршрутизатор не будет посылать или принимать маршрутную информацию от внешних автономных систем. Бит T определяет сервисные возможности маршрутизатора (TOS). Если T=0, это означает, что
маршрутизатор поддерживает только один вид услуг (TOS=0) и он не пригоден для маршрутизации с учетом вида услуг. Такие маршрутизаторы, как правило, не используются для транзитного трафика.</p>

<p align="justify">Протокол ospf использует сообщение типа Hello для взаимообмена данными между соседними маршрутизаторами. Структура пакетов этого типа показана на рис. 4.2.11.2.4. </p>

<p align="center"><img src="image522.gif" tppabs="http://book.itep.ru/4/44/image522.gif"></p>
<p align="center">Рис. 4.2.11.2.4 Формат сообщения Hello в протоколе OSPF</p>

<p align="justify">Поле <i>сетевая маска</i> соответствует маске субсети данного интерфейса. Например, если интерфейс принадлежит сети класса B и третий байт служит для выделения нужной субсети, то сетевая маска будет иметь вид 0xFFFFFF00.</p>

<p align="justify">Поле <i>время</i> между Hello содержит значение времени в секундах, между сообщениями Hello. Поле <i>опции</i> характеризует возможности, которые предоставляет данный маршрутизатор. Поле <i>приоритет</i> характеризует уровень приоритета маршрутизатора (целое положительное число), используется при выборе резервного (backup) маршрутизатора. Если приоритет равен нулю, данный маршрутизатор никогда не будет использован в качестве резервного. Поле <i>время
отключения маршрутизатора</i> определяет временной интервал в секундах, по истечении которого &quot;молчащий&quot; маршрутизатор считается вышедшим из строя. IP-адреса маршрутизаторов, записанные в последующих полях, указывают место, куда следует послать данное сообщение. Поля <i>IP-адрес соседа k</i> образуют список адресов соседних маршрутизаторов, откуда за последнее время были получены сообщения Hello.</p>

<p align="justify">Маршрутизаторы обмениваются сообщениями из баз данных OSPF, чтобы инициализировать, а в дальнейшем актуализовать свои базы данных, характеризующие топологию сети. Обмен происходит в режиме клиент-сервер. Клиент подтверждает получение каждого сообщения. Формат пересылки записей из базы данных представлен на рис. 4.2.11.2.5.</p>

<p align="center"><img src="image523.gif" tppabs="http://book.itep.ru/4/44/image523.gif"></p>
<p align="center">Рис. 4.2.11.2.5 Формат OSPF-сообщений о маршрутах</p>

<p align="justify">Поля, начиная с <i>тип канала</i>, повторяются для каждого описания канала. Так как размер базы данных может быть велик, ее содержимое может пересылаться по частям. Для реализации этого используются биты I и М. Бит I устанавливается в 1 в стартовом сообщении, а бит M принимает единичное состояние для сообщения, которые являются продолжением. Бит S определяет
то, кем послано сообщение (S=1 для сервера, S=0 для клиента, этот бит иногда имеет имя MS). Поле <i>номер сообщения по порядку</i> служит для контроля пропущенных блоков. Первое сообщение содержит в этом поле случайное целое число M, последующие M+1, M+2,...M+L. Поле <i>тип канала</i> может 
принимать следующие значения:</p>

<p align="center">Таблица 4.2.11.2.3. Коды типов состояния каналов (LS)</p>
<div align="center">

<table border="10" cellspacing="1" cellpadding="5" width="700" bgcolor="ghostwhite">
  <tr>
    <td width="13%" valign="top" bgcolor="gainsboro"><p align="center">LS-тип</td>
    <td width="87%" valign="top" bgcolor="gainsboro"><p align="justify">Описание объявления о маршруте</td>
  </tr>
  <tr>
    <td width="13%" valign="top"><p align="center">1</td>
    <td width="87%" valign="top"><p align="justify">Описание каналов маршрутизатора, то есть 
    состояния его интерфейсов.</td>
  </tr>
  <tr>
    <td width="13%" valign="top"><p align="center">2</td>
    <td width="87%" valign="top"><p align="justify">Описание сетевых каналов. Это перечень 
    маршрутизаторов, непосредственно связанных с сетью.</td>
  </tr>
  <tr>
    <td width="13%" valign="top"><p align="center">3 или 4</td>
    <td width="87%" valign="top"><p align="justify">Сводное описание каналов, куда входят маршруты между отдельными областями сети. Эта информация поступает от пограничных маршрутизаторов этих зон. Тип 3 приписан маршрутам, ведущим к сетям, а тип 4 характеризует маршруты, ведущие к пограничным маршрутизаторам автономной системы.</td>
  </tr>
  <tr>
    <td width="13%" valign="top"><p align="center">5</td>
    <td width="87%" valign="top"><p align="justify">Описания внешних связей автономной системы. Такие маршруты начинаются в пограничных маршрутизаторах AS.</td>
  </tr>
</table>
</div>

<p align="justify">Поле <i>идентификатор канала</i> определяет его характер, в зависимости от этого идентификатором может быть IP-адрес маршрутизатора или сети. <i>Маршрутизатор, рекламирующий канал</i> определяет адрес этого маршрутизатора. Поле <i>порядковый номер канала</i> позволяет маршрутизатору контролировать порядок прихода сообщений и их потерю. Поле <i>возраст
канала</i> определяет время в секундах с момента установления связи. После обмена сообщениями с соседями маршрутизатор может выяснить, что часть данных в его базе устарела. Он может послать своим соседям запрос с целью получения свежей маршрутной информации о каком-то конкретном канале связи. Сосед, получивший запрос, высылает необходимую информацию. Запрос посылается в
соответствии с форматом, показанном ниже (рис. 4.2.11.2.6):</p>

<p align="center"><img src="image524.gif" tppabs="http://book.itep.ru/4/44/image524.gif"></p>
<p align="center">Рис. 4.2.11.2.6 Формат ospf-запроса маршрутной информации</p>

<p align="justify">Три поля этого запроса повторяются согласно числу каналов, информация о которых запрашивается. Если список достаточно длинен, может потребоваться несколько запросов. Маршрутизаторы посылают широковещательные (или мультикастинговые) сообщения об изменении состояния своих непосредственных связей. Такое сообщение содержит список объявлений, имеющих
формат (рис. 4.2.11.2.7):</p>

<p align="center"><img src="image525.gif" tppabs="http://book.itep.ru/4/44/image525.gif"></p>
<p align="center">Рис. 4.2.11.2.7 Сообщение об изменении маршрутов</p>

<p align="justify">Сообщения об изменениях маршрутов могут быть вызваны следующими причинами: </p>

<p align="justify">1. Возраст маршрута достиг предельного значения (lsrefreshtime).<br>
2. Изменилось состояние интерфейса.<br>
3. Произошли изменения в маршрутизаторе сети.<br>
4. Произошло изменение состояния одного из соседних маршрутизаторов.<br>
5. Изменилось состояние одного из внутренних маршрутов (появление нового, исчезновение старого и т.д.)<br>
6. Изменение состояния межзонного маршрута.<br>
7. Появление нового маршрутизатора, подключенного к сети.<br>
8. Вариация виртуального маршрута одним из маршрутизаторов.<br>
9. Возникли изменения одного из внешних маршрутов.<br>
10. Маршрутизатор перестал быть пограничным для данной as (например, перезагрузился).</p>

<p align="justify">Каждое сообщение о состоянии канала начинается с заголовка - &quot;объявление состояния канала&quot; (LS– link state). Формат этого типа заголовка приведен ниже (20 октетов):</p>

<p align="center"><img src="image526.gif" tppabs="http://book.itep.ru/4/44/image526.gif"></p>
<p align="center">Рис. 4.2.11.2.8 Формат ospf-сообщения, описывающего состояние канала</p>

<p align="justify">Поле <i>возраст ls</i> информации (рис. 4.2.11.2.8) определяет время в секундах с момента объявления состояния канала. Поле <i>опции</i> содержит значения типов сервиса (TOS), поддерживаемые маршрутизатором, рассылающим маршрутную информацию. Поле <i>тип LS</i> (тип
состояния канала) может принимать значения, описанные выше в табл. 4.2.11.2.3. Следует обратить внимание, что код, содержащийся в этом поле, определяет формат сообщения. Поле <i>длина</i> задает размер сообщения в октетах, включая заголовок. В результате получается сообщение с форматом, показанным на рис. 4.2.11.2.9. Зарезервированный октет должен быть обнулен. Идентификатор связи определяет тип маршрутизатора, подключенного к каналу. Действительное значение этого поля зависит от поля <i>тип</i>. В свою очередь информация о канале
также зависит от поля тип. Число tos определяет многообразие метрик, соответствующих видам сервиса, для данного канала. Последовательность описания метрик задается величиной кода TOS. Таблица кодов TOS, принятых в OSPF протоколе приведена ниже.</p>

<p align="center">Таблица 4.2.11.2.4. Коды типа сервиса (TOS)</p>
<div align="center">

<table border="10" cellspacing="1" cellpadding="5" width="650" bgcolor="ghostwhite">
  <tr>
    <td width="20%" valign="top" bgcolor="gainsboro"><b><p align="justify">OSPF-код</b></td>
    <td width="20%" valign="top" bgcolor="gainsboro"><b><p align="justify">TOS-коды</b></td>
    <td width="60%" valign="top" bgcolor="gainsboro"><b><p align="justify">TOS(RFC-1349)</b></td>
  </tr>
  <tr>
    <td width="20%" valign="top"><p align="justify">0</td>
    <td width="20%" valign="top"><p align="justify">0000</td>
    <td width="60%" valign="top"><p align="justify">Обычный сервис</td>
  </tr>
  <tr>
    <td width="20%" valign="top"><p align="justify">2</td>
    <td width="20%" valign="top"><p align="justify">0001</td>
    <td width="60%" valign="top"><p align="justify">Минимизация денежной стоимости</td>
  </tr>
  <tr>
    <td width="20%" valign="top"><p align="justify">4</td>
    <td width="20%" valign="top"><p align="justify">0010</td>
    <td width="60%" valign="top"><p align="justify">Максимальная надежность</td>
  </tr>
  <tr>
    <td width="20%" valign="top"><p align="justify">8</td>
    <td width="20%" valign="top"><p align="justify">0100</td>
    <td width="60%" valign="top"><p align="left">Максимальная пропускная способность</td>
  </tr>
  <tr>
    <td width="20%" valign="top"><p align="justify">16</td>
    <td width="20%" valign="top"><p align="justify">1000</td>
    <td width="60%" valign="top"><p align="justify">Минимальная задержка</td>
  </tr>
</table></div>

<p align="center"><img src="image527.gif" tppabs="http://book.itep.ru/4/44/image527.gif"></p>
<p align="center">Рис. 4.2.11.2.9 Формат описания типа канала с LS=1</p>

<p align="justify">Если бит V=1 (virtual), маршрутизатор является оконечной точкой активного виртуального канала. Если бит E (external) равен 1, маршрутизатор является пограничным для автономной системы. Бит B=1 (border) указывает на то, что маршрутизатор является пограничным для данной области. Поле <i>тип</i> может принимать значения, приведенные в таблице 4.2.11.2.5.</p>

<p align="center">Таблица 4.2.11.2.5. Коды типов связей (см. рис. 4.2.11.2.9)</p>
<div align="center">

<table border="10" cellspacing="1" cellpadding="5" width="700" bgcolor="ghostwhite">
  <tr>
    <td width="20%" valign="top" bgcolor="gainsboro"><p align="center">Код типа связи</td>
    <td width="80%" valign="top" bgcolor="gainsboro"><p align="justify">Описание</td>
  </tr>
  <tr>
    <td width="20%" valign="top"><p align="center">1</td>
    <td width="80%" valign="top"><p align="justify">Связь с другим маршрутизатором по схеме точка-точка</td>
  </tr>
  <tr>
    <td width="20%" valign="top"><p align="center">2</td>
    <td width="80%" valign="top"><p align="justify">Связь с транзитной сетью</td>
  </tr>
  <tr>
    <td width="11%" valign="top"><p align="center">3</td>
    <td width="89%" valign="top"><p align="justify">Связь с оконечной сетью</td>
  </tr>
  <tr>
    <td width="11%" valign="top"><p align="center">4</td>
    <td width="89%" valign="top"><p align="justify">Виртуальная
    связь (например, опорная сеть или туннель)</td>
  </tr>
</table>
</div>

<p align="justify">Поле <i>идентификатор канала</i> характеризует объект, с которым связывается маршрутизатор. Примеры идентификаторов представлены в таблице:</p>

<p align="center">Таблица 4.2.11.2.6. Коды идентификаторов канала</p>
<div align="center">

<table border="10" cellspacing="1" cellpadding="5" width="700" bgcolor="ghostwhite">
  <tr>
    <td width="33%" valign="top" bgcolor="gainsboro"><p align="center"><b>Код идентификатора</b></td>
    <td width="67%" valign="top" bgcolor="gainsboro"><b><p align="justify">Описание</b></td>
  </tr>
  <tr>
    <td width="33%" valign="top"><b><p align="center">1</b></td>
    <td width="67%" valign="top"><p align="left">Идентификатор соседнего маршрутизатора</td>
  </tr>
  <tr>
    <td width="33%" valign="top"><b><p align="center">2</b></td>
    <td width="67%" valign="top"><p align="left">IP-адрес основного маршрутизатора (по умолчанию)</td>
  </tr>
  <tr>
    <td width="33%" valign="top"><b><p align="center">3</b></td>
    <td width="67%" valign="top"><p align="left">IP-адрес сети/субсети</td>
  </tr>
  <tr>
    <td width="33%" valign="top"><b><p align="center">4</b></td>
    <td width="67%" valign="top"><p align="left">Идентификатор соседнего маршрутизатора</td>
  </tr>
</table></div>

<p align="justify">Маршрутизатор, получивший OSPF-пакет, посылает подтверждение его приема. Этот вид пакетов имеет тип=5 и структуру, отображенную на рис. 4.2.11.2.10. Получение нескольких объявлений о состоянии линий может быть подтверждено одним пакетом. Адресом места назначения этого пакета может быть индивидуальный маршрутизатор, группа маршрутизаторов или все маршрутизаторы
автономной системы.</p>

<p align="center"><img src="image528.gif" tppabs="http://book.itep.ru/4/44/image528.gif"></p>
<p align="center">Рис. 4.2.11.2.10 Формат сообщения о получении OSPF-пакета</p>

<p align="justify">Рекламирование сетевых связей относится к типу 2. Сообщения посылаются для каждой транзитной сети в автономной системе. Транзитной считается сеть, которая имеет более одного маршрутизатора. Сообщение о сетевых связях должно содержать информацию обо всех маршрутизаторах, подключенных к сети, включая тот, который рассылает эту информацию. Расстояние от сети до любого подключенного маршрутизатора равно нулю для всех видов сервиса
(TOS), поэтому поля TOS и метрики в этих сообщениях отсутствуют. Формат сообщения о транзитных сетевых связях показан на рис. 4.2.11.2.11.</p>

<p align="justify">Следует помнить, что приведенные ниже сообщения должны быть снабжены стандартными 24-октетными OSPF-заголовками (на рис. 4.2.11.2.11 отсутствует).</p>

<p align="center"><img src="image529.gif" tppabs="http://book.itep.ru/4/44/image529.gif"></p>
<p align="center">Рис. 4.2.11.2.11 Формат сообщения о сетевых связях (тип LS=2)</p>

<p align="justify"><i>Сетевая маска</i> относится к описываемой сети, а поле <i>подключенный маршрутизатор</i> содержит идентификатор маршрутизатора, работающего в сети. Информация об адресатах в пределах автономной системы
передается LS-сообщениями типа 3 и 4. Тип 3 работает для IP-сетей. В этом случае в качестве идентификатора состояния канала используется IP-адрес сети. Если же адресатом является пограничный маршрутизатор данной AS, то
используется LS-сообщение типа 4, а в поле <i>идентификатор состояния канала</i> записывается OSPF-идентификатор этого маршрутизатора. Во всех
остальных отношениях сообщения 3 и 4 имеют идентичные форматы (рис. 4.2.11.2.12):</p>

<p align="center"><img src="image530.gif" tppabs="http://book.itep.ru/4/44/image530.gif"></p>
<p align="center">Рис. 4.2.11.2.12 Формат сообщений об адресатах в пределах автономной системы</p>

<p align="justify">Поля, следующие после заголовка, повторяются в соответствии с числом описываемых объектов. Рекламирование внешних маршрутов относится к пятому типу. Эта информация рассылается пограничными маршрутизаторами.
Информация о каждом внешнем адресате, известном маршрутизатору, посылается независимо. Этот вид описания используется и для маршрутов по умолчанию, для которых идентификатор состояния канала устанавливается равным 0.0.0.0 (аналогичное значение принимает при этом и сетевая маска). Формат такого сообщения представлен на рис. 4.2.11.2.13.</p>

<p align="center"><img src="image531.gif" tppabs="http://book.itep.ru/4/44/image531.gif"></p>
<p ALIGN="CENTER">Рис. 4.2.11.2.13 Формат описания внешних маршрутов</p>

<p ALIGN="JUSTIFY">Сетевая маска характеризует место назначения рекламируемого маршрута. Так для сети класса A маска может иметь вид 0xFF000000. Последующий
набор полей повторяется для каждого вида TOS. Поля для TOS=0 заполняются всегда, и это описание является первым. Бит E характеризует внешнюю
метрику. Если E=0, то она может непосредственно (без преобразования) сравниваться с метриками других каналов. При E=1 метрика считается больше
любой метрики. Поле <I>адрес пересылки</I> указывает на место, куда будут пересылаться данные, адресованные рекламируемым маршрутом. Если адрес пересылки равен 0.0.0.0, данные посылаются пограничному маршрутизатору
автономной системы - источнику данного сообщения. Метка внешнего маршрута - 32-битовое число, присваиваемое каждому внешнему маршруту. Эта метка самим протоколом OSPF не используется и предназначена для информирования других
автономных систем при работе внешних протоколов маршрутизации. Маршрутная таблица OSPF содержит в себе:</p>

<ul>
  <li>IP-адрес места назначения и маску;</li>
  <li>тип места назначения (сеть, граничный маршрутизатор и т.д.);</li>
  <li>тип функции (возможен набор маршрутизаторов для каждой из функций TOS);</li>
  <li>область (описывает область, связь с которой ведет к цели, возможно несколько записей данного типа, если области действия граничных
    маршрутизаторов перекрываются);</li>
  <li>тип пути (характеризует путь как внутренний, межобластной или внешний, ведущий к AS);</li>
  <li>цена маршрута до цели;</li>
  <li>очередной маршрутизатор, куда следует послать дейтограмму;</li>
  <li>объявляющий маршрутизатор (используется для межобластных обменов и для связей автономных систем друг с другом).</li>
</ul>

<p ALIGN="JUSTIFY">Преимущества OSPF:</p>
<OL>
<LI>Для каждого адреса может быть несколько маршрутных таблиц, по одной на каждый вид IP-операции (TOS).</LI>

<LI>Каждому интерфейсу присваивается безразмерная цена, учитывающая пропускную
способность, время транспортировки сообщения. Для каждой IP-операции может быть присвоена своя цена (коэффициент качества).</LI>
<LI>При существовании эквивалентных маршрутов OSFP распределяет поток равномерно по этим маршрутам.</LI>
<LI>Поддерживается адресация субсетей (разные маски для разных маршрутов).</LI>
<LI>При связи точка-точка не требуется IP-адрес для каждого из концов. (Экономия адресов!)</LI>
<LI>Применение мультикастинга вместо широковещательных сообщений снижает загрузку не вовлеченных сегментов.</LI>
</OL>
<p ALIGN="JUSTIFY">Недостатки:</p>
<OL>
<LI> Трудно получить информацию о предпочтительности каналов для узлов,
поддерживающих другие протоколы, или со статической маршрутизацией.</LI>
<LI> OSPF является лишь внутренним протоколом.</LI>
</OL>






</TD></TR>

<TR bgcolor="steelblue"><TD VALIGN="TOP" bgcolor="steelblue" LINK="#0000FF"><P ALIGN="center">

<FONT color="white"><B> Previous: </B></FONT>
<A HREF="rip44111.htm" tppabs="http://book.itep.ru/4/44/rip44111.htm"><FONT COLOR="lightblue">4.4.11.1 Внутренний    протокол маршрутизации RIP</FONT></A>



<FONT color="white"><B> &nbsp; &nbsp;UP:</B></FONT>
<A HREF="rut_4411.htm" tppabs="http://book.itep.ru/4/44/rut_4411.htm"><FONT COLOR="lightblue">4.4.11 Протоколы    маршрутизации (обзор, таблицы маршрутизации, вектор расстояния)</FONT></A>


<BR>

<FONT color="white"><B>  Down:</B></FONT>
<A HREF="proc_45.htm" tppabs="http://book.itep.ru/4/45/proc_45.htm"><FONT COLOR="lightblue">4.5 Процедуры Интернет</FONT></A>



<FONT color="white"><B> &nbsp; &nbsp;Next:</B></FONT>
<A HREF="igp44113.htm" tppabs="http://book.itep.ru/4/44/igp44113.htm"><FONT COLOR="lightblue">4.4.11.3 Протокол IGRP</FONT></A>

</TD>
  </TR>
</table>
</BODY>
</HTML>